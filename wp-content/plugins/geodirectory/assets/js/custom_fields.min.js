jQuery(document).ready(function($){jQuery(".gd-advanced-toggle").on("click",function(){setTimeout(function(){gd_toggle_switch_display()},100)});jQuery(".gd-form-builder-tab ul li.gd-cf-tooltip-wrap a").on("click",function(){if(!jQuery(this).attr("id")){return}var type=jQuery(this).data("field-type");var type_key=jQuery(this).data("field-type-key");var custom_type=jQuery(this).data("field-custom-type");var post_type=jQuery("#gd_new_post_type").val();var id="new"+jQuery(".field_row_main ul.core li:last").index();var manage_field_type=jQuery(".manage_field_type").val();var gd_nonce=jQuery("#gd_new_field_nonce").val();var single_use=jQuery(this).data("field-single-use");if(single_use){var is_used=false;jQuery('input[name^="htmlvar_name"]').each(function(i){if(jQuery(this).val()==single_use){is_used=true;alert(geodir_params.txt_single_use)}});if(is_used){return false}}if(manage_field_type=="general"||manage_field_type=="cpt-sorting"){if(jQuery("#setName_"+id).length){alert(geodir_params.txt_save_other_setting);jQuery("html, body").animate({scrollTop:jQuery("#setName_"+id).offset().top},1e3);return}jQuery(".core.ui-sortable li .field_frm").hide();if(manage_field_type=="general"){var action="geodir_get_custom_field_form"}else if(manage_field_type=="cpt-sorting"){var action="geodir_get_custom_field_sorting_form"}jQuery.get(ajaxurl+"?action="+action,{field_type:type,field_type_key:type_key,listing_type:post_type,field_id:id,field_ins_upd:"new",manage_field_type:manage_field_type,custom_type:custom_type,security:gd_nonce},function(data){if(jQuery(".field_row_main ul.dd-list li").length>0){jQuery(".field_row_main ul.dd-list").append(data)}else{jQuery(".field_row_main ul.dd-list").html(data)}jQuery("#setName_"+id).find("#sort_order").val(parseInt(jQuery("#setName_"+id).index())+1);jQuery("select.geodir-select").trigger("geodir-select-init");jQuery("select.geodir-select-nostd").trigger("geodir-select-init");jQuery("#setName_"+id+" .dd-form > .fa-caret-down").trigger("click");jQuery("html, body").animate({scrollTop:jQuery("#setName_"+id).offset().top},1e3);gd_init_tooltips();gd_toggle_switch_display();if(jQuery(".gd-advanced-toggle").hasClass("gda-hide")){jQuery("#setName_"+id+" .gd-advanced-toggle").addClass("gda-hide");jQuery("#setName_"+id+" .gd-advanced-setting, #default_location_set_address_button").addClass("gda-show")}init_advanced_settings();if(manage_field_type=="general"){jQuery(document.body).trigger("geodir_on_get_custom_field",[{id:id,field:data}])}else if(manage_field_type=="cpt-sorting"){jQuery(document.body).trigger("geodir_on_sort_custom_field",[{id:id,field:data}])}});if(manage_field_type=="sorting_options"){jQuery(this).closest("li").hide()}}});$(document).on("change",".geodir-cpt-cf-items .dd-item input,.geodir-cpt-cf-items .dd-item select,.geodir-cpt-cf-items .dd-item textarea",function(e){var $this=this;setTimeout(function(){geodir_auto_save_custom_field($this,$)},250)});gd_toggle_switch_display();jQuery("body").on("geodir_on_save_custom_field",function(e,data){});jQuery("body").on("geodir_on_get_custom_field",function(e,data){});gd_init_sort_options();gd_init_custom_fields_sortable();gd_init_tabs_layout();geodir_field_init_conditional($)});function gd_data_type_changed(obj,cont){var dtype,$el;if(obj&&cont){dtype=jQuery(obj).val();$el=jQuery("#setName_"+cont);jQuery('[data-setting="price_heading"]',$el).hide();jQuery('[data-setting="is_price"]',$el).hide();jQuery('[data-setting="currency_symbol"]',$el).hide();jQuery('[data-setting="currency_symbol_placement"]',$el).hide();jQuery('[data-setting="thousand_separator"]',$el).hide();jQuery('[data-setting="decimal_separator"]',$el).hide();jQuery('[data-setting="decimal_point"]',$el).hide();jQuery('[data-setting="decimal_display"]',$el).hide();if(dtype=="INT"||dtype=="FLOAT"||dtype=="DECIMAL"){jQuery('[data-setting="price_heading"]',$el).show();jQuery('[data-setting="is_price"]',$el).show();jQuery('[data-setting="thousand_separator"]',$el).show();if(dtype=="FLOAT"||dtype=="DECIMAL"){jQuery('[data-setting="decimal_separator"]',$el).show();jQuery('[data-setting="decimal_point"]',$el).show();jQuery('[data-setting="decimal_display"]',$el).show()}if(jQuery('input[name="extra[is_price]"]',$el).is(":checked")){jQuery('[data-setting="currency_symbol"]',$el).show();jQuery('[data-setting="currency_symbol_placement"]',$el).show()}}}}function gd_save_custom_field(id){if(jQuery("#setName_"+id+" #frontend_title").length>0){var frontend_title=jQuery("#setName_"+id+" #frontend_title").val();if(frontend_title==""){alert(geodir_params.custom_field_not_blank_var);return false}}var fieldrequest=jQuery("#setName_"+id+" > .dd-form").find("select, textarea, input").serialize();var request_data="create_field=true&field_ins_upd=submit&"+fieldrequest;jQuery.ajax({url:ajaxurl+"?action=geodir_save_custom_field",type:"POST",data:request_data,success:function(result){var res=result;if(res.success==false){alert(res.data)}else{jQuery("#setName_"+id).replaceWith(jQuery.trim(result));jQuery(".field_frm").hide();var field_id=jQuery(result).find("#field_id").val();field_id=field_id?field_id:id;jQuery(document.body).trigger("geodir_on_save_custom_field",[{id:field_id,field:res}]);gd_tabs_save_order("geodir_order_custom_fields")}jQuery("select.geodir-select").trigger("geodir-select-init");jQuery("select.geodir-select-nostd").trigger("geodir-select-init");gd_init_tooltips()}})}function gd_show_hide(id){if(id.substring(0,9)=="field_frm"){jQuery(".field_frm").not("#"+id).hide()}jQuery("#"+id).toggle()}function gd_show_hide_radio(id,sh,cl){setTimeout(function(){$show=jQuery(id).is(":checked");if($show){console.log("checked");jQuery(id).closest(".dd-setting").find("."+cl).show("fast")}else{console.log("unchecked");jQuery(id).closest(".dd-setting").find("."+cl).hide("fast")}},100)}function gd_order_custom_fields(order){var gd_nonce=jQuery("#gd_new_field_nonce").val();order=order+"&security="+gd_nonce;jQuery.ajax({url:ajaxurl+"?action=geodir_order_custom_fields",type:"POST",data:order,success:function(result){if(result.success==false){alert(result.data)}}})}function gd_order_custom_sort_fields(order){var gd_nonce=jQuery("#gd_new_field_nonce").val();order=order+"&security="+gd_nonce;jQuery.ajax({url:ajaxurl+"?action=geodir_order_custom_sort_fields",type:"POST",data:order,success:function(result){if(result.success==false){alert(result.data)}}})}function gd_delete_sort_field(id,nonce,obj){var confarmation=confirm(geodir_params.custom_field_delete);if(confarmation==true){if(id.substring(0,3)=="new"){jQuery("#setName_"+id).remove()}else{jQuery.get(ajaxurl+"?action=geodir_delete_custom_sort_field",{field_id:id,_wpnonce:nonce},function(data){jQuery("#setName_"+id).remove();var field_type=jQuery(obj).closest("li").find("#field_type").val();var htmlvar_name=jQuery(obj).closest("li").find("#htmlvar_name").val();jQuery("#gd-"+field_type+"-_-"+htmlvar_name).closest("li").show()})}}}function gd_toggle_switch_display(){jQuery("[data-gdat-display-switch-set]").each(function(){var toggleClass=jQuery(this).data("gdat-display-switch-set");var switchValue=jQuery(this).find("input:checked").val();jQuery(this).parent().find("."+toggleClass).each(function(){if(jQuery(this).hasClass("gd-advanced-setting")){if(jQuery(this).hasClass("gda-show")&&switchValue==1){jQuery(this).show()}else{jQuery(this).hide()}}else{if(switchValue==1){jQuery(this).show()}else{jQuery(this).hide()}}})})}function gd_init_sort_options(){jQuery(".gd-sortable-sortable").nestedSortable({maxLevels:2,handle:"div.dd-handle",items:"li",disableNestingClass:"mjs-nestedSortable-no-nesting",helper:"clone",placeholder:"placeholder",forcePlaceholderSize:true,listType:"ul",update:function(event,ui){gd_tabs_save_order("geodir_order_custom_sort_fields")}});jQuery("select.geodir-select").trigger("geodir-select-init");jQuery("select.geodir-select-nostd").trigger("geodir-select-init")}function gd_save_sort_field(id){var fieldrequest=jQuery("#setName_"+id+" > .dd-form").find("select, textarea, input").serialize();var request_data="create_field=true&field_ins_upd=submit&"+fieldrequest;jQuery.ajax({url:ajaxurl+"?action=geodir_save_custom_sort_field",type:"POST",data:request_data,success:function(result){console.log(result);if(result.success==false){alert(result.data)}else{jQuery("#setName_"+id).replaceWith(jQuery.trim(result));var order=jQuery(".field_row_main ul.core").sortable("serialize")+"&update=update&manage_field_type=sorting_options";jQuery("#setName_"+id).find('input[name="is_default"]').each(function(){if(jQuery(this).attr("checked")=="checked"){jQuery(".field_row_main").find('input[name="is_default"]').not(this).attr("checked",false)}});gd_tabs_save_order("geodir_order_custom_sort_fields")}}})}function gd_init_custom_fields_sortable(){jQuery(".gd-custom-fields-sortable").nestedSortable({maxLevels:2,handle:"div.dd-handle",items:"li",disableNestingClass:"mjs-nestedSortable-no-nesting",helper:"clone",placeholder:"placeholder",forcePlaceholderSize:true,listType:"ul",update:function(event,ui){gd_tabs_save_order("geodir_order_custom_fields")}});jQuery("select.geodir-select").trigger("geodir-select-init");jQuery("select.geodir-select-nostd").trigger("geodir-select-init")}function gd_delete_custom_field(id,nonce){if(jQuery("#setName_"+id+" ul li.dd-item").length){alert(geodir_params.custom_field_delete_children)}else{var confarmation=confirm(geodir_params.custom_field_delete);if(confarmation==true){if(id.substring(0,3)=="new"){jQuery("#setName_"+id).remove()}else{jQuery.get(ajaxurl+"?action=geodir_delete_custom_field",{field_id:id,field_ins_upd:"delete",security:nonce},function(data){var res=data;if(!res.success){alert(res.data)}else{jQuery("#setName_"+id).remove();gd_tabs_save_order("geodir_order_custom_fields")}})}}}}function gd_init_tabs_layout(){jQuery(".gd-tabs-layout-sortable").nestedSortable({maxLevels:2,handle:"div.dd-handle",items:"li",disableNestingClass:"mjs-nestedSortable-no-nesting",helper:"clone",placeholder:"placeholder",forcePlaceholderSize:true,listType:"ul",update:function(event,ui){gd_tabs_save_order("geodir_save_tabs_order")}});jQuery("select.geodir-select").trigger("geodir-select-init");jQuery("select.geodir-select-nostd").trigger("geodir-select-init")}function gd_tabs_item_settings($this){var $dd=jQuery($this).parent().find(".dd-setting");var is_open=!$dd.is(":hidden");jQuery(".dd-setting").hide();if(is_open){jQuery($this).addClass("fa-caret-down").removeClass("fa-caret-up");$dd.hide().removeClass("gd-tab-settings-open")}else{jQuery($this).addClass("fa-caret-up").removeClass("fa-caret-down");$dd.show().addClass("gd-tab-settings-open");if(jQuery(".geodir-select",$dd).length){jQuery(".geodir-select",$dd).removeClass("enhanced");jQuery("select.geodir-select",$dd).trigger("geodir-select-init")}}}function gd_tabs_add_tab($this){if(jQuery("#setName_").length){alert(geodir_params.txt_save_other_setting);jQuery("html, body").animate({scrollTop:jQuery("#setName_").offset().top},1e3);return}var gd_nonce=jQuery("#gd_new_field_nonce").val();var $post_type=jQuery("#gd_new_post_type").val();var $tab_layout=jQuery($this).data("tab_layout");var $tab_type=jQuery($this).data("tab_type");var $tab_name=jQuery($this).data("tab_name");var $tab_icon=jQuery($this).data("tab_icon");var $tab_key=jQuery($this).data("tab_key");var $tab_content=jQuery($this).data("tab_content");var data={action:"geodir_get_tabs_form",security:gd_nonce,post_type:$post_type,tab_layout:$tab_layout,tab_name:$tab_name,tab_type:$tab_type,tab_icon:$tab_icon,tab_key:$tab_key,tab_content:$tab_content};jQuery.ajax({url:ajaxurl,type:"POST",data:data,success:function(result){console.log(result);if(result.success){jQuery(".gd-tabs-sortable").append(result.data);gd_init_tabs_layout();jQuery(".gd-tabs-sortable > li:last-child .fa-caret-down").trigger("click");jQuery("html, body").animate({scrollTop:jQuery("#setName_").offset().top},1e3)}else{alert("something went wrong")}}})}function gd_tabs_save_tab($this){var $form=jQuery($this).closest(".dd-form");console.log($form.find("select, textarea, input").serialize());var gd_nonce=jQuery("#gd_new_field_nonce").val();var data=$form.find("select, textarea, input").serialize()+"&security="+gd_nonce+"&action=geodir_save_tab_item";jQuery.ajax({url:ajaxurl,type:"POST",data:data,success:function(result){console.log(result);if(result.success){var $li=jQuery($form).closest("li");jQuery($li).replaceWith(result.data);gd_init_tabs_layout();gd_tabs_save_order("geodir_save_tabs_order")}else{alert(result.data)}}})}function gd_tabs_delete_tab($this){var $form=jQuery($this).closest(".dd-form");var $li=jQuery($form).closest("li");console.log($form.serialize());var gd_nonce=jQuery("#gd_new_field_nonce").val();var $post_type=jQuery("#gd_new_post_type").val();var $tab_id=jQuery($form).find("input[name=id]").val();if(!$tab_id){jQuery($form).closest("li").remove();return}var data={action:"geodir_delete_tab",security:gd_nonce,post_type:$post_type,tab_id:$tab_id};jQuery.ajax({url:ajaxurl,type:"POST",data:data,success:function(result){console.log(result);if(result.success){var $li=jQuery($form).closest("li").remove();gd_init_tabs_layout()}else{alert(result.data)}}})}function gd_tabs_save_order($action){$tabs=jQuery(".gd-tabs-sortable").nestedSortable("toArray",{startDepthCount:0});console.log($tabs);var $order={};jQuery.each($tabs,function(index,tab){console.log(index+": "+tab);if(tab.id){$order[index]={id:tab.id,tab_level:tab.depth,tab_parent:tab.parent_id}}});console.log($order);var gd_nonce=jQuery("#gd_new_field_nonce").val();var data={action:$action,security:gd_nonce,tabs:$order};jQuery.ajax({url:ajaxurl,type:"POST",data:data,success:function(result){console.log(result);if(result.success){}else{alert(result.data)}}})}function geodir_auto_save_custom_field(el,jQ){var $li=jQuery(el).closest(".dd-item"),title=jQuery('[name="frontend_title"]',$li).val(),fData,data,$btn,fieldId,attr;title=title.trim();if(!title){return}$btn=jQuery("[name='save']",$li);fData=jQuery("input,select,textarea",$li).serialize();data="create_field=true&field_ins_upd=submit&"+fData;if($li.hasClass("geodir-cf-saving")){return}jQuery.ajax({url:ajaxurl+"?action=geodir_auto_save_custom_field",type:"POST",data:data,dataType:"json",beforeSend:function(xhr,obj){jQuery('[name="sort_order"]',$li).val(parseInt($li.index())+1);jQuery('[name="htmlvar_name"]',$li).prop("readonly",true);$li.removeClass("geodir-cf-saved").addClass("geodir-cf-saving");$btn.prop("disabled",true);jQuery(".geodir-cf-status,.geodir-cf-tstatus",$li).remove();jQuery(".dd-setting",$li).append('<span class="geodir-cf-tstatus"><i class="fas fa-sync fa-spin" aria-hidden="true"></i> '+geodir_params.txt_saving+"</span>");$btn.after('<span class="geodir-cf-status"><i class="fas fa-sync fa-spin" aria-hidden="true"></i> '+geodir_params.txt_saving+"</span>")}}).done(function(data,textStatus,jqXHR){if(typeof data=="object"&&data.success&&data.data.field_id){if(data.data.field_icon){jQuery(".dd-handle .dd-icon i",$li).prop("class",data.data.field_icon)}if(data.data.admin_title){jQuery(".dd-handle .dd-title",$li).text(data.data.admin_title)}if(jQuery('[name="field_id"]',$li).val()=="new-1"){fieldId=data.data.field_id;jQuery('[name="field_id"]',$li).val(fieldId);jQuery('[name="htmlvar_name"]',$li).val(data.data.htmlvar_name);jQuery('[name="security"]',$li).val(data.data.nonce);$li.prop("id","setName_"+fieldId);$li.prop("data-select2-id","setName_"+fieldId);jQuery('[name="admin_title"]',$li).prop("id","gd-admin-title-"+fieldId);attr=jQuery('[name="data_type"]',$li).attr("onchange");if(attr){jQuery('[name="data_type"]',$li).attr("onchange",attr.replace("new-1",fieldId))}attr=jQuery('[name="save"]',$li).attr("onclick");if(attr){jQuery('[name="save"]',$li).attr("onclick",attr.replace("new-1",fieldId))}jQuery("a.item-delete",$li).attr("onclick","gd_delete_custom_field('"+fieldId+"','"+data.data.nonce+"');return false;")}$li.addClass("geodir-cf-saved");jQuery(".geodir-cf-status",$li).html('<i class="fas fa-check-circle" aria-hidden="true"></i> '+geodir_params.txt_saved)}}).always(function(data,textStatus,jqXHR){$btn.prop("disabled",false);$li.removeClass("geodir-cf-saving");jQuery(".geodir-cf-tstatus",$li).remove();if(!jQuery('[name="htmlvar_name"]',$li).val()){jQuery('[name="htmlvar_name"]',$li).prop("readonly",false)}})}function geodir_field_init_conditional($){if(!$("#geodir_conditional_fields").length){return}$(document.body).on("click",".geodir-conditional-add",function(){geodir_field_add_condition(this)});$(document.body).on("click",".geodir-conditional-remove",function(){geodir_field_remove_condition(this)});$(document.body).on("click",'[data-setting="conditional_fields_heading"]',function(){if($(this).hasClass("geodir-con-fields-open")){$(this).removeClass("geodir-con-fields-open").addClass("geodir-con-fields-hidden");$(this).closest(".dd-setting").find("#geodir_conditional_fields").hide()}else{$(this).removeClass("geodir-con-fields-hidden").addClass("geodir-con-fields-open");$(this).closest(".dd-setting").find("#geodir_conditional_fields").show()}})}function geodir_field_add_condition(el){if(jQuery(el).hasClass("disabled")){return false}var $cont=jQuery(el).closest("#geodir_conditional_fields"),$items=$cont.find(".geodir-conditional-items");template=$cont.find(".geodir-conditional-template").html();jQuery(template).find(".geodir-conditional-el").val("");$items.append(template);geodir_field_refresh_conditions($items)}function geodir_field_remove_condition(el){var $fields=jQuery(el).closest("#geodir_conditional_fields"),$items=$fields.find(".geodir-conditional-items");jQuery(el).closest(".geodir-conditional-row").remove();geodir_field_refresh_conditions($items);$fields.find(".geodir-conditional-template .geodir-conditional-action").trigger("change")}function geodir_field_refresh_conditions($items){if($items.find(".geodir-conditional-row").length){$items.find(".geodir-conditional-row").each(function(i){jQuery(this).attr("data-condition-index",i);jQuery(this).find(".geodir-conditional-action").prop("id","conditional_action_"+i).prop("name","conditional_fields["+i+"][action]");jQuery(this).find(".geodir-conditional-field").prop("id","conditional_field_"+i).prop("name","conditional_fields["+i+"][field]");jQuery(this).find(".geodir-conditional-condition").prop("id","conditional_condition_"+i).prop("name","conditional_fields["+i+"][condition]");jQuery(this).find(".geodir-conditional-value").prop("id","conditional_value_"+i).prop("name","conditional_fields["+i+"][value]")})}}